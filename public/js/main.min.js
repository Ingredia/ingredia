
$(function () {

    "use strict";

    var global = this,
        aside  = false;

    var resource = [
        "img/work/1-1.jpg",
        "img/work/1-2.jpg",
        "img/work/2-1.jpg",
        "img/work/3-1.jpg"
    ],
        list = [
        "img/letter_3.jpg",
        "img/letter_2.jpg",
        "img/helo_cover.jpg",
        "img/coach_cover.jpg",
        "img/planet_cover.jpg",
        "img/poet_cover.jpg",
        "img/peace_1.jpg",
        "img/island_1.jpg"
    ];

    $("#button-menu").bind('click', toggleMenu);


    $("#module li").bind('click', function (event) {

        var index = parseInt($(this).attr('data-scroll'));

        $("html,body").
            stop().
            animate({
                scrollTop: $("article").eq(index).offset().top
            }, 300, 'swing');

    });

    $("#button-next").bind('click', function (event) {

        $("html,body").
            stop().
            animate({
                scrollTop: $("article").eq(1).offset().top
            }, 300, 'swing');

    });

    $(".work").hover(function() {

        $(this).find('img').addClass('img-trans-in');
        $(this).find('img').removeClass('img-trans-out');
        $(this).find('.mask, .state').
            stop().
            animate({opacity: 1}, 500, 'swing');

    }, function() {

        $(this).find('img').addClass('img-trans-out');
        $(this).find('img').removeClass('img-trans-in');
        $(this).find('.mask, .state').
            stop().
            animate({opacity: 0}, 500, 'swing');
        // Solid

    });

    $("#tab p").click(function (event) {

        $("#c").stop().animate({top: "0"}, 200, 'swing');

    });

    $("#button-close-tab").click(function (event) {

        $("#c").stop().animate({top: "-100%"}, 200, 'swing');

    });

    $("#footer span").click(function (event) {

        $("html,body").
            stop().
            animate({
                scrollTop: 0
            }, 300, 'swing');

    });

    $(window).scroll(function (event) {

        var valueOpacity = 1 - $(window).scrollTop() * 0.002,
            valueWidth = 30 - $(window).scrollTop() * 0.01;
            // valueHeight = 300 - $(window).scrollTop() * 0.6;

        if (valueOpacity <= 0 || valueWidth <= 0) { return; }

        $("#background").css({
            opacity: valueOpacity + "",
            width: valueWidth + "%"
        });

    });

    function toggleMenu(event) {

        var dist = $("#aside").width();

        if (!aside) {

            aside = true;

            $("#page").bind('click', toggleMenu);

            $("#page, #aside, #button-menu, #show").
                stop().
                animate({
                    left: "+=" + dist + "px"
                }, 400, 'easeOutSine');

            buttonAnimate();

        } else {

            aside = false;

            $("#page").unbind('click', toggleMenu);

            $("#page, #aside, #button-menu, #show").
                stop().
                animate({
                    left: "-=" + dist + "px"
                }, 300, 'easeInSine');

            buttonAnimate();

        }

        event.stopPropagation();


        function buttonAnimate() {

            $("#button-menu").hasClass('is-active') ?
            $("#button-menu").removeClass('is-active') : $("#button-menu").addClass('is-active');

        }

    }



    $(window).load(loadWork);
    $("#container img.img-trans-out").load(removeLoadingAnimation);

    function loadWork() {

        var array = document.getElementById("container").
                             getElementsByClassName("work");

        // Load images.
        for (var i = 0; i <= array.length - 1; i++) {
            array[i].appendChild(createLoadingAnimation());
            array[i].insertBefore(preloadImage(list[i]),
                                  array[i].getElementsByClassName("mask")[0]);
        }

    }


    function displayWork(start, howmany) {

        $("#show").fadeIn('400', function() {
            // Load images.
            for (var i = 0; i <= howmany - 1; i++) {
                document.getElementById("displayer").
                         appendChild(preloadImage(resource[start + i]));
            }
        });

    }

    function hideWork() {

        $("#show").fadeOut('400', function() {
            document.removeChild(
                document.getElementById("work"));
        });

    }

    function preloadImage(url) {

        var image = document.createElement("img");
        image.src = url;

        return image;

    }


    function createLoadingAnimation() {

        var loading = document.createElement("svg");

        loading.class = "loading-animation";

        loading.width   = "38";
        loading.height  = "38";
        loading.viewBox = "0 0 38 38";
        loading.xmlns   = "http://www.w3.org/2000/svg";
        loading.stroke  = "#fff";
        loading.fill    = "#000";

        loading.innerHTML = "<g fill='none' fill-rule='evenodd'><g transform='translate(1 1)' stroke-width='2'><circle stroke-opacity='.5' cx='18' cy='18' r='18'/><path d='M36 18c0-9.94-8.06-18-18-18'><animateTransform attributeName='transform' type='rotate' from='0 18 18' to='360 18 18' dur='1s' repeatCount='indefinite'/></path></g></g>";

        return loading;

    }

    function removeLoadingAnimation() {

        $(this).siblings('.loading-animation').hide('400');

    }


    $(".work").bind('click', function(event) {

        displayWork( $(this).attr('data-start'),
                     $(this).attr('data-count') );

    });
    $("#button-exit").bind('click', hideWork);

});
